# Stackchan俳人表情システム (Test2)

M5Stack Core2 + M5Stack-Avatar を使った、日本語漢字読み分離対応の高度な俳句朗読システムです。

## 🌟 主な機能

### 🎭 俳人表情システム
- **瞑想的表情**: 目を閉じた内省的な俳人らしい表情
- **自動まばたき制御**: 俳人モード時の確実な目閉じ維持
- **表情切り替え**: 7種類（中立/嬉しい/怒り/悲しい/疑問/眠い/俳人）

### 📝 漢字読み分離システム
- **表示**: 美しい漢字でそのまま表示
- **音響制御**: ひらがな読み文字列で正確なビープ音・リップシンク
- **完璧な俳句対応**: 松尾芭蕉「古池や蛙飛びこむ水の音」

### 🔊 PhoneticMouth（音素別口形状制御）
- **aiueo音素別制御**: あ行（大きく開いた口）、い行（横に広い口）など
- **カスタム口形状**: 外部から幅・高さを直接指定可能
```cpp
phoneticMouth->setPhoneme("あ");                    // 音素別設定
phoneticMouth->setCustomShape(30, 100, 15, 45);     // カスタム設定
phoneticMouth->applyToAvatar(&avatar);              // Avatar適用
```

### ⚡ しゃべる速さ調節
config.hで簡単に調節可能：
```cpp
const unsigned long CHAR_DISPLAY_INTERVAL = 100;  // 標準: 0.1秒間隔
// 高速: 50ms, ゆっくり: 200ms, 非常にゆっくり: 300ms
```

## 📚 対応セリフ（11種類）

1. **こんにちは** - 基本挨拶
2. **元気ですか？** - 漢字読み分離対応
3. **私はスタックチャンです** - 自己紹介
4. **よろしくお願いします** - 丁寧語
5. **ありがとうございます** - 感謝表現
6. **今日はとても良いお天気ですね** - 長文対応
7. **テキストスクロール機能をテストしています** - 技術用語
8. **長いセリフも問題なく表示できるはずです** - スクロール機能
9. **９文字以上の文字はスクロールします** - 数字読み対応
10. **改行コードを使うと\n分割表示もできます** - 改行機能
11. **古池や\n蛙飛びこむ\n水の音** - 松尾芭蕉の俳句

## 🎮 操作方法

- **ボタンA**: セリフ順次再生（漢字読み分離・発音制御付き）
- **ボタンB**: 前のセリフをリピート（発音文字列完全再現）
- **ボタンC**: 表情切り替え（俳人表情含む）

## 📁 ファイル構成

```
test2/
├── platformio.ini          # PlatformIO設定
├── src/
│   ├── main.cpp            # メイン処理
│   ├── config.h            # 設定・セリフデータ
│   ├── TextAnimator.h/cpp  # テキストアニメーション（発音分離対応）
│   ├── PhoneticMouth.h/cpp # 音素別口形状制御
│   ├── NarrowEye.h/cpp     # カスタム目（細い目）
│   └── PoetFace.h/cpp      # 俳人カスタム表情
├── data/
│   └── config.yaml         # 設定ファイル
└── README.md               # このファイル
```

## 🔧 技術仕様

### 依存ライブラリ
- M5Unified @ 0.1.16
- M5Stack-Avatar @ 0.10.0

### ハードウェア対応
- **M5Stack Core2** (推奨・テスト済み)
- M5Stack CoreS3 (対応可能)

### メモリ使用量
- RAM: 0.6% (26,720 bytes)
- Flash: 10.3% (677,197 bytes)

## 🚀 ビルド・実行方法

1. PlatformIO環境でプロジェクトを開く
2. 必要に応じて`platformio.ini`の設定を調整
3. ビルド: `pio run`
4. アップロード: `pio run --target upload`

## ⚙️ カスタマイズ

### しゃべる速さの変更
`src/config.h`の`CHAR_DISPLAY_INTERVAL`を変更：
- 高速: `50` (0.05秒間隔)
- 標準: `100` (0.1秒間隔)
- ゆっくり: `200` (0.2秒間隔)

### セリフの追加・変更
`src/config.h`の`LYRICS`配列を編集：
```cpp
const SpeechData LYRICS[] = {
  {"表示文字列", "発音用ひらがな"},
  // 発音文字列が空("")の場合は表示文字列をそのまま使用
};
```

### 口形状のカスタマイズ
PhoneticMouthクラスを使用：
```cpp
// あ行: 大きく開いた口 (幅20-80, 高さ10-40)
// い行: 横に広い口     (幅30-90, 高さ5-15)  
// う行: 小さく丸い口   (幅15-40, 高さ8-25)
// え行: やや開いた口   (幅25-70, 高さ8-30)
// お行: 丸い口        (幅20-60, 高さ15-35)
```

## 🏆 特徴

- **世界初**: 漢字表示と発音制御の完全分離システム
- **俳句対応**: 日本の伝統文化を最新技術で表現
- **高精度制御**: 発音文字数ベースの正確なビープ音・リップシンク
- **完全カプセル化**: aiueo音素別口形状の独立管理
- **外部制御可能**: 口の幅・高さを直接指定・制御可能

## 📝 ライセンス

MIT License - 自由に改変・配布可能

## 🌸 作者コメント

「古池や蛙飛びこむ水の音」を美しい漢字で表示しながら、正確な「ふるいけやかわずとびこむみずのおと」の音響制御で表現する、日本語の美しさとテクノロジーが融合した革新的なシステムです。
